# Pro Cycling Helper

Right now, this model can detect cyclists in footage of pro cycling races. I'd like to update it to classify cyclists it detects by team.

In order to do this, my plan is to train a classifier on the cropped cyclist images generated by the current model (I've self labelled some). This should work fine just with YOLO, but would not be able to generalize to new teams well (I'd need to retrain for each race with new teams). In cycling, teams often change their jerseys, even multiple times a season, and riders often ride in national champion jerseys or leaders jerseys. To make this more scalable, I'd like to take embeddings from the trained classifier and cluster them and do my inference from those clusters. Ideally when a new team is run through the model, a new cluster is formed. Then I can use some UI to update team names for new detected clusters.

Something like [this setup](https://engineering.atspotify.com/2023/12/recursive-embedding-and-clustering/) from Spotify is what I'm trying to emulate.

I've done visualization of embeddings with raw DINOv2 in exploration.ipynb. There was not separation of teams.

## TODO
### Main line
* Do embedding visualization for YOLO-CLS to check current clumping and to have code ready to use on trained model
    * Need to work out how to chop the head off right
* Add more classified team images to Roboflow
* Train YOLO-CLS to distinguish teams - check accuracy
* Chop off head and see if it clumps more
* Evaluate clustering algorithms
* Test on new teams (e.g. in TDF with some new jerseys, or in older years with all new teams)

### Optimizations/Cleaning
* Improve cyclist detection
    * I think annotating & detecting spectators and motos would help them not be classified as cyclists
* Look at a vector DB
* Write actual inference code as a function
* Clean up data_collection & add readme for that step

### Working with end product
* Check camera time by team by race - who was getting the most exposure this season?
* Combine with face detection to approximate riders being 'in the wind' - which teams spend most time in the wind each race?
* Are there patterns in which teams are on camera early vs. late in the race?